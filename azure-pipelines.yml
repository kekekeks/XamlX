jobs:
  - job: Linux
    pool:
      vmImage: 'ubuntu-24.04'
    steps:
      - task: UseDotNet@2
        displayName: 'Use .NET SDK 10.0.100'
        inputs:
          version: 10.0.100-rc.2.25502.107
          includePreviewVersions: true

      - task: UseDotNet@2
        displayName: 'Use .NET Runtime 8.0'
        inputs:
          packageType: runtime
          version: 8.0.x

      - task: CmdLine@2
        displayName: 'Run Tests'
        inputs:
          script: |
            mono --version
            dotnet --info
            dotnet build
            dotnet test -f net10.0 --logger "trx" --results-directory artifacts/test-results
            dotnet test -f net8.0 --logger "trx" --results-directory artifacts/test-results
            dotnet test -f net47  --logger "trx" --results-directory artifacts/test-results
      - task: PublishTestResults@2
        inputs:
          testResultsFormat: 'VSTest'
          testResultsFiles: '$(Build.SourcesDirectory)/artifacts/test-results/*.trx'
        condition: not(canceled())


  - job: Windows
    pool:
      vmImage: 'windows-2025'
    variables:
      SolutionDir: '$(Build.SourcesDirectory)'
    steps:
      - task: UseDotNet@2
        displayName: 'Use .NET SDK 10.0.100'
        inputs:
          version: 10.0.100-rc.2.25502.107
          includePreviewVersions: true
          
      - task: UseDotNet@2
        displayName: 'Use .NET Runtime 8.0'
        inputs:
          packageType: runtime
          version: 8.0.x

      - task: CmdLine@2
        displayName: 'Run Tests'
        inputs:
          script: |
            dotnet --info
            dotnet build
            dotnet test -f net10.0 --logger "trx" --results-directory artifacts/test-results
            dotnet test -f net8.0 --logger "trx" --results-directory artifacts/test-results
            dotnet test -f net47  --logger "trx" --results-directory artifacts/test-results

      - task: PublishTestResults@2
        inputs:
          testResultsFormat: 'VSTest'
          testResultsFiles: '$(Build.SourcesDirectory)/artifacts/test-results/*.trx'
        condition: not(canceled())